<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestión de Botones Internos y Externos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .btn {
      display: block;
      margin: 5px 0;
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: fit-content;
    }
    .btn:hover {
      background-color: #0056b3;
    }
    #outsideContainer {
      margin: 20px 0;
    }
    h3 {
      margin-top: 25px;
    }
  </style>
</head>
<body>

  <h2>Administrador de Opciones</h2>

  <select id="dropdown" class="btn"></select>

  <h3>Botones físicos fuera del desplegable:</h3>
  <div id="outsideContainer"></div>

  <button id="finalBtn" class="btn" style="background-color: #28a745;">
    Mostrar y eliminar opciones
  </button>

  <script>
    const dropdown = document.getElementById('dropdown');
    const outsideContainer = document.getElementById('outsideContainer');
    const finalBtn = document.getElementById('finalBtn');

    const botones = {}; // { id: { nombre, mensaje, ubicacion, boton? } }

    const LIMITE_INTERNOS = 5;

    function generarId() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let id;
      do {
        id = chars.charAt(Math.floor(Math.random() * chars.length));
      } while (id in botones);
      return id;
    }

    function actualizarDropdown() {
      dropdown.innerHTML = `
        <option disabled selected>-- Acciones --</option>
        <option value="createInside">🟦 Crear opción interna</option>
        <option value="createOutside">🟨 Crear botón fuera</option>
      `;

      for (let id in botones) {
        if (botones[id].ubicacion === 'inside') {
          dropdown.innerHTML += `<option value="${id}">${id} = ${botones[id].nombre}</option>`;
        }
      }
    }

    function crearOpcionInterna() {
      const internos = Object.values(botones).filter(b => b.ubicacion === 'inside').length;
      if (internos >= LIMITE_INTERNOS) {
        alert(`Has alcanzado el límite de ${LIMITE_INTERNOS} opciones internas.`);
        return;
      }

      const nombre = prompt("Nombre de la opción interna:");
      if (!nombre) return;

      const mensaje = prompt("Mensaje que debe mostrar:");
      if (!mensaje) return;

      const id = generarId();
      botones[id] = { nombre, mensaje, ubicacion: 'inside' };
      actualizarDropdown();
    }

    function crearBotonFuera() {
      const nombre = prompt("Nombre del botón físico:");
      if (!nombre) return;

      const mensaje = prompt("Mensaje que debe mostrar:");
      if (!mensaje) return;

      const id = generarId();
      const nuevoBtn = document.createElement('button');
      nuevoBtn.textContent = nombre;
      nuevoBtn.className = 'btn';
      nuevoBtn.addEventListener('click', () => alert(mensaje));
      outsideContainer.appendChild(nuevoBtn);

      botones[id] = { nombre, mensaje, ubicacion: 'outside', boton: nuevoBtn };
    }

    dropdown.addEventListener('change', () => {
      const val = dropdown.value;

      if (val === 'createInside') {
        crearOpcionInterna();
      } else if (val === 'createOutside') {
        crearBotonFuera();
      } else if (botones[val]) {
        const b = botones[val];
        alert(`Mensaje de "${b.nombre}":\n\n${b.mensaje}`);
        const eliminar = confirm(`¿Deseas eliminar "${b.nombre}" (ID: ${val})?`);
        if (eliminar) {
          if (b.ubicacion === 'outside') {
            outsideContainer.removeChild(b.boton);
          }
          delete botones[val];
          actualizarDropdown();
        }
      }

      dropdown.selectedIndex = 0;
    });

    finalBtn.addEventListener('click', () => {
      if (Object.keys(botones).length === 0) {
        alert("No hay elementos para mostrar.");
        return;
      }

      let resumen = "Opciones actuales:\n";
      for (let id in botones) {
        const tipo = botones[id].ubicacion === 'inside' ? "Interna" : "Externa";
        resumen += `${id} = ${botones[id].nombre} (${tipo})\n`;
      }

      const accion = prompt(resumen + "\nEscribe un ID para eliminarlo, o deja vacío para cancelar:");
      if (accion && botones[accion]) {
        const b = botones[accion];
        if (b.ubicacion === 'outside') {
          outsideContainer.removeChild(b.boton);
        }
        delete botones[accion];
        actualizarDropdown();
        alert(`Eliminado: ${accion}`);
      } else if (accion) {
        alert("ID inválido.");
      }
    });

    actualizarDropdown();
  </script>
</body>
</html>
