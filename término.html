<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Web Interactiva</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background-color: #1e1e1e;
            color: #00ff00;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }

        .terminal-header {
            background-color: #2d2d2d;
            padding: 10px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-title {
            font-weight: bold;
        }

        .terminal-controls {
            display: flex;
            gap: 8px;
        }

        .control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .close {
            background-color: #ff5f56;
        }

        .minimize {
            background-color: #ffbd2e;
        }

        .maximize {
            background-color: #27c93f;
        }

        .terminal-body {
            flex: 1;
            background-color: #000;
            padding: 15px;
            overflow-y: auto;
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
            height: calc(100vh - 80px);
        }

        .command-line {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .prompt {
            margin-right: 10px;
            white-space: nowrap;
        }

        .input-line {
            background-color: transparent;
            border: none;
            color: #00ff00;
            outline: none;
            flex: 1;
            font-size: 16px;
        }

        .output {
            margin-bottom: 10px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .error {
            color: #ff6b6b;
        }

        .directory {
            color: #6cb6ff;
        }

        .file {
            color: #f8f8f2;
        }

        .command {
            color: #ff79c6;
        }

        .help-command {
            margin-left: 20px;
            display: block;
        }
    </style>
</head>
<body>
    <div class="terminal-header">
        <div class="terminal-title">Terminal Web</div>
        <div class="terminal-controls">
            <div class="control close"></div>
            <div class="control minimize"></div>
            <div class="control maximize"></div>
        </div>
    </div>
    <div class="terminal-body" id="terminal">
        <div class="output">
            Bienvenido a la Terminal Web Interactiva.<br>
            Escribe 'help' para ver los comandos disponibles.<br><br>
            Directorio actual: <span class="directory" id="current-dir">/home/usuario</span>
        </div>
        <div class="command-line">
            <span class="prompt" id="prompt">usuario@terminal:~$</span>
            <input type="text" class="input-line" id="command-input" autofocus>
        </div>
    </div>

    <script>
        // Estado de la terminal
        const state = {
            currentDir: '/home/usuario',
            fileSystem: {
                '/home/usuario': {
                    type: 'directory',
                    contents: {
                        'documentos': { type: 'directory', contents: {} },
                        'descargas': { type: 'directory', contents: {} },
                        'leeme.txt': { type: 'file', content: 'Bienvenido a tu terminal virtual.' }
                    }
                }
            },
            commandHistory: [],
            historyIndex: -1
        };

        // Elementos DOM
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        const currentDirElement = document.getElementById('current-dir');
        const promptElement = document.getElementById('prompt');

        // Comandos disponibles
        const commands = {
            'help': {
                description: 'Muestra esta ayuda',
                execute: () => {
                    return `
Comandos disponibles:
<span class="command">help</span> - Muestra esta ayuda
<span class="command">ls</span> [directorio] - Lista archivos y directorios
<span class="command">cd</span> [directorio] - Cambia de directorio
<span class="command">pwd</span> - Muestra el directorio actual
<span class="command">mkdir</span> [nombre] - Crea un nuevo directorio
<span class="command">touch</span> [nombre] - Crea un nuevo archivo
<span class="command">cat</span> [archivo] - Muestra el contenido de un archivo
<span class="command">echo</span> [texto] - Muestra texto en la terminal
<span class="command">clear</span> - Limpia la terminal
<span class="command">date</span> - Muestra la fecha y hora actual
<span class="command">whoami</span> - Muestra el usuario actual
<span class="command">history</span> - Muestra el historial de comandos
                    `;
                }
            },
            'ls': {
                description: 'Lista archivos y directorios',
                execute: (args) => {
                    const targetDir = args[0] || state.currentDir;
                    const dir = resolvePath(targetDir);
                    
                    if (!dir || dir.type !== 'directory') {
                        return `<span class="error">Error: Directorio no encontrado</span>`;
                    }
                    
                    const contents = Object.keys(dir.contents);
                    if (contents.length === 0) {
                        return 'El directorio está vacío';
                    }
                    
                    return contents.map(item => {
                        const itemType = dir.contents[item].type;
                        return `<span class="${itemType}">${item}</span>`;
                    }).join('  ');
                }
            },
            'cd': {
                description: 'Cambia de directorio',
                execute: (args) => {
                    if (args.length === 0) {
                        state.currentDir = '/home/usuario';
                    } else {
                        const targetPath = resolvePath(args[0]);
                        if (targetPath && targetPath.type === 'directory') {
                            state.currentDir = normalizePath(args[0]);
                        } else {
                            return `<span class="error">Error: Directorio no encontrado</span>`;
                        }
                    }
                    updatePrompt();
                    return '';
                }
            },
            'pwd': {
                description: 'Muestra el directorio actual',
                execute: () => {
                    return state.currentDir;
                }
            },
            'mkdir': {
                description: 'Crea un nuevo directorio',
                execute: (args) => {
                    if (args.length === 0) {
                        return `<span class="error">Error: Se requiere un nombre para el directorio</span>`;
                    }
                    
                    const dirName = args[0];
                    const currentDir = getCurrentDir();
                    
                    if (currentDir.contents[dirName]) {
                        return `<span class="error">Error: Ya existe un elemento con ese nombre</span>`;
                    }
                    
                    currentDir.contents[dirName] = {
                        type: 'directory',
                        contents: {}
                    };
                    
                    return `Directorio '${dirName}' creado correctamente`;
                }
            },
            'touch': {
                description: 'Crea un nuevo archivo',
                execute: (args) => {
                    if (args.length === 0) {
                        return `<span class="error">Error: Se requiere un nombre para el archivo</span>`;
                    }
                    
                    const fileName = args[0];
                    const currentDir = getCurrentDir();
                    
                    if (currentDir.contents[fileName]) {
                        return `<span class="error">Error: Ya existe un elemento con ese nombre</span>`;
                    }
                    
                    currentDir.contents[fileName] = {
                        type: 'file',
                        content: ''
                    };
                    
                    return `Archivo '${fileName}' creado correctamente`;
                }
            },
            'cat': {
                description: 'Muestra el contenido de un archivo',
                execute: (args) => {
                    if (args.length === 0) {
                        return `<span class="error">Error: Se requiere un nombre de archivo</span>`;
                    }
                    
                    const fileName = args[0];
                    const file = resolvePath(fileName);
                    
                    if (!file || file.type !== 'file') {
                        return `<span class="error">Error: Archivo no encontrado</span>`;
                    }
                    
                    return file.content || '(archivo vacío)';
                }
            },
            'echo': {
                description: 'Muestra texto en la terminal',
                execute: (args) => {
                    return args.join(' ');
                }
            },
            'clear': {
                description: 'Limpia la terminal',
                execute: () => {
                    // Limpiar el contenido de la terminal excepto la línea de comando actual
                    const outputs = terminal.querySelectorAll('.output');
                    outputs.forEach(output => output.remove());
                    return '';
                }
            },
            'date': {
                description: 'Muestra la fecha y hora actual',
                execute: () => {
                    return new Date().toString();
                }
            },
            'whoami': {
                description: 'Muestra el usuario actual',
                execute: () => {
                    return 'usuario';
                }
            },
            'history': {
                description: 'Muestra el historial de comandos',
                execute: () => {
                    if (state.commandHistory.length === 0) {
                        return 'No hay comandos en el historial';
                    }
                    return state.commandHistory.map((cmd, index) => `${index + 1}  ${cmd}`).join('\n');
                }
            }
        };

        // Funciones auxiliares
        function getCurrentDir() {
            return resolvePath(state.currentDir);
        }

        function resolvePath(path) {
            // Si es una ruta absoluta
            if (path.startsWith('/')) {
                const parts = path.split('/').filter(p => p !== '');
                let current = state.fileSystem['/'];
                
                for (const part of parts) {
                    if (current.contents && current.contents[part]) {
                        current = current.contents[part];
                    } else {
                        return null;
                    }
                }
                return current;
            }
            // Si es una ruta relativa
            else {
                const parts = path.split('/').filter(p => p !== '');
                let current = getCurrentDir();
                
                for (const part of parts) {
                    if (part === '..') {
                        // Subir un nivel (implementación simplificada)
                        const parentPath = state.currentDir.split('/').slice(0, -1).join('/') || '/';
                        current = resolvePath(parentPath);
                    } else if (part !== '.') {
                        if (current.contents && current.contents[part]) {
                            current = current.contents[part];
                        } else {
                            return null;
                        }
                    }
                }
                return current;
            }
        }

        function normalizePath(path) {
            if (path.startsWith('/')) {
                return path;
            }
            
            // Para rutas relativas, construir la ruta absoluta
            const currentParts = state.currentDir.split('/').filter(p => p !== '');
            const pathParts = path.split('/').filter(p => p !== '');
            
            for (const part of pathParts) {
                if (part === '..') {
                    currentParts.pop();
                } else if (part !== '.') {
                    currentParts.push(part);
                }
            }
            
            return '/' + currentParts.join('/');
        }

        function updatePrompt() {
            const dirName = state.currentDir.split('/').pop() || '/';
            promptElement.textContent = `usuario@terminal:${dirName}$`;
            currentDirElement.textContent = state.currentDir;
        }

        // Manejo de entrada de comandos
        commandInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const commandText = commandInput.value.trim();
                
                if (commandText) {
                    // Agregar al historial
                    state.commandHistory.push(commandText);
                    state.historyIndex = state.commandHistory.length;
                    
                    // Procesar comando
                    processCommand(commandText);
                }
                
                // Limpiar entrada
                commandInput.value = '';
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (state.commandHistory.length > 0) {
                    if (state.historyIndex > 0) {
                        state.historyIndex--;
                    }
                    commandInput.value = state.commandHistory[state.historyIndex] || '';
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (state.historyIndex < state.commandHistory.length - 1) {
                    state.historyIndex++;
                    commandInput.value = state.commandHistory[state.historyIndex] || '';
                } else {
                    state.historyIndex = state.commandHistory.length;
                    commandInput.value = '';
                }
            }
        });

        function processCommand(commandText) {
            // Crear elemento para mostrar el comando ejecutado
            const commandElement = document.createElement('div');
            commandElement.className = 'output';
            commandElement.innerHTML = `<span class="prompt">${promptElement.textContent}</span> ${commandText}`;
            terminal.insertBefore(commandElement, commandInput.parentNode);
            
            // Dividir comando y argumentos
            const parts = commandText.split(' ').filter(part => part !== '');
            const commandName = parts[0];
            const args = parts.slice(1);
            
            // Ejecutar comando
            let output = '';
            if (commands[commandName]) {
                output = commands[commandName].execute(args);
            } else {
                output = `<span class="error">Comando no encontrado: ${commandName}. Escribe 'help' para ver los comandos disponibles.</span>`;
            }
            
            // Mostrar resultado
            if (output) {
                const outputElement = document.createElement('div');
                outputElement.className = 'output';
                outputElement.innerHTML = output;
                terminal.insertBefore(outputElement, commandInput.parentNode);
            }
            
            // Desplazar hacia abajo para mostrar el resultado
            terminal.scrollTop = terminal.scrollHeight;
        }

        // Inicializar
        updatePrompt();
    </script>
</body>
</html>
