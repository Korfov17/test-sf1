<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestor de Marcadores con Carpetas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 1rem auto;
      padding: 0 1rem;
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .box {
      background: white;
      border-radius: 6px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 6px #ccc;
    }
    .box h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      text-align: center;
      font-weight: bold;
    }
    label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 600;
    }
    input[type="text"], input[type="url"], textarea, select {
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 0.8rem;
      padding: 0.3rem 0.5rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    textarea {
      min-height: 60px;
    }
    button {
      background: #2d89ef;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.15s ease-in-out;
    }
    button:hover {
      background: #1b5cb8;
      transform: scale(1.1);
    }
    #folderSelect {
      margin-bottom: 1rem;
    }
    .folder {
      margin-bottom: 0.8rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #eef3fb;
    }
    .folderHeader {
      background: #c2d1f5;
      padding: 0.5rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    .folderName {
      user-select: none;
    }
    .folderContents {
      padding: 0.5rem 1rem;
      display: none;
    }
    .bookmark {
      border-bottom: 1px solid #ddd;
      padding: 0.3rem 0;
    }
    .bookmark:last-child {
      border-bottom: none;
    }
    .bookmarkHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .bookmarkHeader a {
      color: #1a0dab;
      text-decoration: none;
      word-break: break-word;
      max-width: 80%;
    }
    .bookmarkHeader a:hover {
      text-decoration: underline;
    }
    .bookmarkDescription {
      margin-left: 0.5rem;
      font-size: 0.9rem;
      color: #555;
      white-space: pre-wrap;
    }
    .btnSmall {
      background: #d9534f;
      padding: 0.3rem 0.6rem;
      font-size: 0.85rem;
      border-radius: 3px;
      margin-left: 0.5rem;
      user-select: none;
    }
    .btnSmall:hover {
      background: #c9302c;
      transform: scale(1.1);
    }
  </style>
</head>
<body>

  <h1>Gestor de Marcadores con Carpetas</h1>

  <div class="box" id="addBookmarkBox">
    <h2>Agregar nuevo marcador</h2>
    <label for="bookmarkName">Nombre:</label>
    <input type="text" id="bookmarkName" placeholder="Nombre del marcador" />
    <label for="bookmarkUrl">URL:</label>
    <input type="url" id="bookmarkUrl" placeholder="https://ejemplo.com" />
    <label for="bookmarkDesc">Descripción (opcional):</label>
    <textarea id="bookmarkDesc" placeholder="Descripción del marcador"></textarea>
    <label for="folderSelect">Guardar en carpeta:</label>
    <select id="folderSelect">
      <option value="">(Sin carpeta)</option>
    </select>
    <button id="addBookmarkBtn">Agregar marcador</button>
  </div>

  <div class="box" id="createFolderBox">
    <h2>Crear nueva carpeta</h2>
    <label for="newFolderName">Nombre de carpeta:</label>
    <input type="text" id="newFolderName" placeholder="Nombre de la carpeta" />
    <button id="createFolderBtn">Crear carpeta</button>
  </div>

  <div class="box" id="savedBookmarksBox">
    <h2>Marcadores guardados</h2>
    <div id="savedBookmarks"></div>
  </div>

  <script>
    // --- LocalStorage helpers ---
    function getBookmarks() {
      try {
        return JSON.parse(localStorage.getItem('bookmarks')) || [];
      } catch {
        return [];
      }
    }
    function setBookmarks(bookmarks) {
      localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    }
    function getFolders() {
      try {
        return JSON.parse(localStorage.getItem('folders')) || [];
      } catch {
        return [];
      }
    }
    function setFolders(folders) {
      localStorage.setItem('folders', JSON.stringify(folders));
    }

    // Actualizar lista desplegable de carpetas
    function updateFolderSelect() {
      const select = document.getElementById('folderSelect');
      const folders = getFolders();

      const current = select.value;

      // Limpiar opciones excepto la primera (sin carpeta)
      while (select.options.length > 1) select.remove(1);

      folders.forEach(folder => {
        const opt = document.createElement('option');
        opt.value = folder.name;
        opt.textContent = folder.name;
        select.appendChild(opt);
      });

      // Restaurar selección si existe
      if ([...select.options].some(o => o.value === current)) {
        select.value = current;
      } else {
        select.value = '';
      }
    }

    // Crear marcador nuevo
    function addBookmark() {
      const name = document.getElementById('bookmarkName').value.trim();
      const url = document.getElementById('bookmarkUrl').value.trim();
      const desc = document.getElementById('bookmarkDesc').value.trim();
      const folderName = document.getElementById('folderSelect').value;

      if (!name || !url) {
        alert('Debes ingresar al menos un nombre y una URL válidos.');
        return;
      }

      // Validar URL (simple)
      try {
        new URL(url);
      } catch {
        alert('La URL ingresada no es válida.');
        return;
      }

      if (!folderName) {
        // Sin carpeta
        const bookmarks = getBookmarks();
        bookmarks.push({ name, url, description: desc });
        setBookmarks(bookmarks);
      } else {
        // En carpeta
        let folders = getFolders();
        const folderIndex = folders.findIndex(f => f.name === folderName);
        if (folderIndex >= 0) {
          folders[folderIndex].bookmarks.push({ name, url, description: desc });
          setFolders(folders);
        } else {
          alert('Carpeta seleccionada no existe.');
          return;
        }
      }

      // Limpiar inputs
      document.getElementById('bookmarkName').value = '';
      document.getElementById('bookmarkUrl').value = '';
      document.getElementById('bookmarkDesc').value = '';
      document.getElementById('folderSelect').value = '';

      renderBookmarks();
    }

    // Crear carpeta nueva
    function createFolder() {
      const folderName = document.getElementById('newFolderName').value.trim();
      if (!folderName) {
        alert('Introduce un nombre para la carpeta');
        return;
      }

      let folders = getFolders();

      if (folders.some(f => f.name.toLowerCase() === folderName.toLowerCase())) {
        alert('Ya existe una carpeta con ese nombre');
        return;
      }

      folders.push({ name: folderName, bookmarks: [] });
      setFolders(folders);
      document.getElementById('newFolderName').value = '';

      updateFolderSelect();
      renderBookmarks();
    }

    // Eliminar marcador
    function deleteBookmark(folderName, index) {
      if (!confirm('¿Eliminar marcador?')) return;

      if (!folderName) {
        // Sin carpeta
        let bookmarks = getBookmarks();
        bookmarks.splice(index, 1);
        setBookmarks(bookmarks);
      } else {
        let folders = getFolders();
        const folderIndex = folders.findIndex(f => f.name === folderName);
        if (folderIndex >= 0) {
          folders[folderIndex].bookmarks.splice(index, 1);
          setFolders(folders);
        }
      }
      renderBookmarks();
    }

    // Eliminar carpeta
    function deleteFolder(folderName) {
      if (!confirm('¿Eliminar carpeta y todos sus marcadores?')) return;
      let folders = getFolders();
      folders = folders.filter(f => f.name !== folderName);
      setFolders(folders);
      updateFolderSelect();
      renderBookmarks();
    }

    // Toggle carpeta (mostrar u ocultar)
    function toggleFolder(event, folderName) {
      // Evitar toggle si clic fue en botón de eliminar
      if (event.target.tagName === 'BUTTON') return;

      const folderContent = event.currentTarget.nextElementSibling;
      if (!folderContent) return;

      const isOpen = folderContent.style.display === 'block';
      folderContent.style.display = isOpen ? 'none' : 'block';
    }

    // Crear elemento de marcador
    function createBookmarkElement(bookmark, folderName, index) {
      const bmEl = document.createElement('div');
      bmEl.className = 'bookmark';

      const header = document.createElement('div');
      header.className = 'bookmarkHeader';

      const link = document.createElement('a');
      link.href = bookmark.url;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.textContent = bookmark.name;

      const btnDelete = document.createElement('button');
      btnDelete.className = 'btnSmall';
      btnDelete.textContent = 'Eliminar';
      btnDelete.onclick = () => deleteBookmark(folderName, index);

      header.appendChild(link);
      header.appendChild(btnDelete);

      bmEl.appendChild(header);

      if (bookmark.description) {
        const desc = document.createElement('div');
        desc.className = 'bookmarkDescription';
        desc.textContent = bookmark.description;
        bmEl.appendChild(desc);
      }

      return bmEl;
    }

    // Renderizar todos los marcadores y carpetas
    function renderBookmarks() {
      const container = document.getElementById('savedBookmarks');
      container.innerHTML = '';

      // Marcadores sin carpeta
      const bookmarks = getBookmarks();
      bookmarks.forEach((bm, i) => {
        const bmEl = createBookmarkElement(bm, null, i);
        container.appendChild(bmEl);
      });

      // Carpetas
      const folders = getFolders();
      folders.forEach(folder => {
        const folderEl = document.createElement('div');
        folderEl.className = 'folder';

        // Header clickable para expandir
        const header = document.createElement('div');
        header.className = 'folderHeader';
        header.onclick = e => toggleFolder(e, folder.name);

        const nameEl = document.createElement('div');
        nameEl.className = 'folderName';
        nameEl.textContent = folder.name;

        // Botón eliminar carpeta
        const btnDeleteFolder = document.createElement('button');
        btnDeleteFolder.className = 'btnSmall';
        btnDeleteFolder.textContent = 'Eliminar carpeta';
        btnDeleteFolder.onclick = e => {
          e.stopPropagation();
          deleteFolder(folder.name);
        };

        header.appendChild(nameEl);
        header.appendChild(btnDeleteFolder);

        // Contenido carpeta (oculto por defecto)
        const content = document.createElement('div');
        content.className = 'folderContents';
        content.style.display = 'none';

        folder.bookmarks.forEach((bm, i) => {
          const bmEl = createBookmarkElement(bm, folder.name, i);
          content.appendChild(bmEl);
        });

        folderEl.appendChild(header);
        folderEl.appendChild(content);
        container.appendChild(folderEl);
      });

      updateFolderSelect();
    }

    // Eventos
    document.getElementById('addBookmarkBtn').addEventListener('click', addBookmark);
    document.getElementById('createFolderBtn').addEventListener('click', createFolder);

    // Inicializar
    updateFolderSelect();
    renderBookmarks();
  </script>

</body>
</html>
 
